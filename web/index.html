<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <script type="module">
            import __wbg_init, { fileLoaded, setPanicHook } from "./pkg/rjvm_web.js";

            await __wbg_init();
            setPanicHook();

            globalThis.appendText = function(text) {
                document.getElementById("outputTextarea").value += text;
            }

            function init() {
                let fileInput = document.createElement('input');
                fileInput.style.display = "block";
                fileInput.type = 'file';
                fileInput.id = "fileInput";
                document.body.appendChild(fileInput);
                fileInput.addEventListener("change", function(e) {
                    let file = e.target.files[0]; 

                    let reader = new FileReader();
                    reader.readAsArrayBuffer(file);

                    reader.addEventListener("loadend", function(e) {
                        fileLoaded(file.name, new Uint8Array(reader.result));
                    });
                });

                let outputTextarea = document.createElement("textarea");
                outputTextarea.style.width = "70vw";
                outputTextarea.style.height = "40vh";
                outputTextarea.style.resize = "none";
                outputTextarea.id = "outputTextarea";
                outputTextarea.value = "$ ";
                document.body.appendChild(outputTextarea);
            }

            init();
        </script>
    </body>
</html>

